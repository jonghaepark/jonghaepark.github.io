<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">

  <!-- Basic meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Periodic Skill Discovery">
  <meta name="keywords" content="Reinforcement Learning, Unsupervised Skill Discovery, Periodicity">

  <title>Periodic Skill Discovery</title>

  <!-- Fonts & CSS -->
  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro" rel="stylesheet">
  <link rel="stylesheet" href="./static/css/bulma.min.css">
  <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
  <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="./static/css/index.css">
  <link rel="icon" href="./static/images/favicon.svg">

  <!-- JS -->
  <script defer src="./static/js/fontawesome.all.min.js"></script>
  <script src="./static/js/bulma-carousel.min.js"></script>
  <script src="./static/js/bulma-slider.min.js"></script>
  <script src="./static/js/index.js"></script>

</head>
<body>

<!-- NAVBAR -->
<nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>
  <div class="navbar-menu">
    <div class="navbar-start" style="flex-grow:1; justify-content:center;">
      <a class="navbar-item" href="https://jonghaepark.github.io/" aria-label="Top">
        <span class="icon"><i class="fas fa-home"></i></span>
      </a>
      <a class="navbar-item" href="#abstract">Abstract</a>
      <a class="navbar-item" href="#results">Results</a>
      <a class="navbar-item" href="#bibtex">BibTeX</a>
    </div>
  </div>
</nav>

<!-- HERO / TITLE -->
<section class="hero" id="top">
  <div class="hero-body">
    <div class="container is-max-desktop">
      <div class="columns is-centered">
        <div class="column has-text-centered">
          <h1 class="title is-1 publication-title">Periodic Skill Discovery</h1>

      <div class="is-size-5 publication-authors">
        <span class="author-block" style="margin-right: 0.6em;"><a href="https://jonghaepark.github.io/" rel="noopener">Jonghae Park<sup>1</sup></a></span>
        <span class="author-block" style="margin-right: 0.6em;">Daesol Cho<sup>2</sup></span>
        <span class="author-block" style="margin-right: 0.6em;">Jusuk Lee<sup>1</sup></span>
        <span class="author-block" style="margin-right: 0.6em;">Dongseok Shim<sup>1</sup></span>
        <span class="author-block" style="margin-right: 0.6em;">Inkyu Jang<sup>1</sup></span>
        <span class="author-block">H. Jin Kim<sup>1</sup></span>
      </div>

      <div class="is-size-6 publication-authors" style="margin-top: 4px;">
        <span class="author-block" style="margin-right: 0.6em;"><sup>1</sup>Seoul National University</span>
        <span class="author-block"><sup>2</sup>Georgia Institute of Technology</span>
      </div>

      <div class="is-size-6 has-text-weight-semibold" style="color: #FA5543; margin-top: 6px;">
        Accepted at NeurIPS 2025
      </div>
          <p class="has-text-danger" style="margin-top: 4px;">
            I’m currently working on this project page — please check back soon!
          </p>
          <div class="column has-text-centered">
            <div class="publication-links">
              <!-- Update hrefs to your files/links -->
              <span class="link-block">
                <a href="./static/videos/psd_paper.pdf" class="button is-normal is-rounded is-dark">
                  <span class="icon"><i class="fas fa-file-pdf"></i></span><span>Paper (PDF)</span>
                </a>
              </span>
              <span class="link-block">
                <a href="https://arxiv.org/abs/XXXX.XXXXX" class="button is-normal is-rounded is-dark">
                  <span class="icon"><i class="ai ai-arxiv"></i></span><span>arXiv</span>
                </a>
              </span>
              <span class="link-block">
                <a href="https://github.com/yourrepo/psd" class="button is-normal is-rounded is-dark">
                  <span class="icon"><i class="fab fa-github"></i></span><span>Code</span>
                </a>
              </span>
              <span class="link-block">
                <a href="./static/videos/psd_poster.pdf" class="button is-normal is-rounded is-dark">
                  <span class="icon"><i class="far fa-image"></i></span><span>Poster</span>
                </a>
              </span>
            </div>
          </div>

        </div> <!-- column -->
      </div> <!-- columns -->
    </div> <!-- container -->
  </div> <!-- hero-body -->
</section>

<!-- TEASER -->
<section class="section" id="teaser-section" style="padding-top: 3rem; padding-bottom: 2rem;">
  <div class="container" style="text-align: center; max-width: 1100px;">

    <!-- PDF→SVG 이미지 -->
    <img src="./static/images/psd_teaser.svg"
         alt="Periodic Skill Discovery Teaser"
         style="
           max-width: 90%;
           height: auto;
           margin-bottom: 1.2rem;
           border-radius: 10px;
         ">


    <h2 class="subtitle"
        style="
          all: unset;                  /* 👈 기본 h2/subtitle 스타일 완전 초기화 */
          display: block;
          font-style: italic;
          font-size: 1.4rem;
          color: #333;
          line-height: 1.3;
          letter-spacing: 0.015em;
          text-align: center;
          margin: 0;                   /* 👈 위아래 여백 완전 제거 */
          padding: 0;                  /* 👈 내부 여백도 제거 */
        ">
      Fundamental observation in nature is that nearly all forms of locomotion are inherently periodic!
    </h2>
  </div>
</section>


<!-- ABSTRACT -->
<section class="section" id="abstract">
  <div class="container is-max-desktop">
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Abstract</h2>
        <div class="content has-text-justified">
          <p>
            Unsupervised skill discovery in reinforcement learning (RL) aims to learn diverse behaviors without relying on external rewards. However, current methods often overlook the periodic nature of learned skills, focusing instead on increasing the mutual dependency between states and skills or maximizing the distance traveled in latent space. Considering that many robotic tasks—particularly those involving locomotion—require periodic behaviors across varying timescales, the ability to discover diverse periodic skills is essential. Motivated by this, we propose <b>Periodic Skill Discovery (PSD)</b>, a framework that discovers periodic behaviors in an unsupervised manner. The key idea of PSD is to train an encoder that maps states to a circular latent space, thereby naturally encoding periodicity in the latent representation. By capturing temporal distance, PSD can effectively learn skills with diverse periods in complex robotic tasks, even with pixel-based observations. We further show that these learned skills achieve high performance on downstream tasks such as hurdling. Moreover, integrating PSD with an existing skill discovery method offers more diverse behaviors, thus broadening the agent’s repertoire.
          </p>
        </div>
      </div>
    </div>
  </div>
</section>


<!-- REL WORK -->
<section class="section" id="method">
  <div class="container" style="max-width: 1100px; margin: 0 auto;">
    <div class="columns is-centered">
      <div class="column is-full-width">
        <h2 class="title is-3" style="text-align: left;">
          Why might previous methods fail to learn multi-timescale behaviors?
        </h2>

        <div class="content" style="text-align: left;">

          <p>
            Existing unsupervised skill discovery methods typically maximize either the
            <i>mutual information</i> between states and skills or the <i>distance</i>
            between latent representations. However, both approaches struggle to explicitly
            regulate <b>multi-timescale periodic behaviors</b>.
          </p>

          <!-- 1) MI-based -->
          <h4 class="title is-4" style="margin-top: 1.5em; text-align: left;">
            1. Mutual Information-based Skill Discovery
          </h4>
          <p>
            MI-based approaches maximize the dependency between states \(S\) and skills \(Z\),
            so that each skill corresponds to distinguishable states:
          </p>

          <p style="margin: 0.8em 0;">
            \[
              I(S;Z)
              = \mathbb{E}_{z,\tau}[\log p(z\!\mid\!s)]
              - \mathbb{E}_{z}[\log p(z)]
              \;\;\approx\;\;
              \mathbb{E}_{z,\tau}[\log q_\theta(z\!\mid\!s)] + \text{const}.
            \]
          </p>

          <p>
            Here, \(q_\theta(z\!\mid\!s)\) is a skill discriminator that infers the skill
            from the current state. The agent is rewarded when the discriminator can predict
            the skill with high confidence. Consequently, these methods tend to produce
            <b>easy-to-distinguish but static</b> skills, offering little incentive for
            temporally rich or periodic behaviors.
          </p>

          <!-- 2) Distance-maximizing -->
          <h4 class="title is-4" style="margin-top: 1.5em; text-align: left;">
            2. Distance-Maximizing Skill Discovery
          </h4>
          <p>
            Distance-based methods instead learn latent embeddings that maximize the
            displacement between consecutive states along skill directions:
          </p>

          <p style="margin: 0.8em 0;">
            \[
              \mathcal{J}_{\text{DSD}}
              := \mathbb{E}_{(z,\tau)\sim\mathcal{D}}
              \big[(\phi(s_{t+1})-\phi(s_t))^\top z\big]
              \quad \text{s.t.}\quad
              \|\phi(x)-\phi(y)\| \le d(x,y),\;\forall x,y\in\mathcal{D}.
            \]
          </p>

          <p>
            Depending on the metric \(d\) (e.g., Euclidean, controllability-aware,
            temporal, or language-based), the agent discovers behaviors that move far in
            the latent space. However, this objective encourages only
            <b>maximally deviating or fast-moving behaviors</b>, without providing an
            incentive to modulate their <b>temporal scale or periodicity</b>.
          </p>

          <!-- Clean takeaway with translucent gray box -->
          <div style="
            margin-top: 2em;
            padding: 1em 1.2em;
            background: rgba(240, 240, 240, 0.8);
            border-radius: 10px;
            text-align: center;
            font-style: italic;
            color: #444;
          ">
            In short, MI-based methods favor discriminability, and distance-based methods
            favor magnitude of deviation — neither captures the <b>temporal structure</b>
            essential for <b>multi-timescale periodic behaviors</b>.
          </div>

        </div>
      </div>
    </div>
  </div>
</section>

<!-- MathJax for equations (keep once per page) -->
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>


<!-- METHOD -->
<section class="section" id="Periodic Skill Discovery">
  <div class="container" style="max-width: 1100px; margin: 0 auto;">
    <div class="columns is-centered">
      <div class="column is-full-width">
        <h2 class="title is-3" style="text-align: left;">Periodic Skill Discovery</h2>

        <div class="content" style="text-align: left;">
          <p>
            <b>Periodic Skill Discovery (PSD)</b> is a framework for unsupervised skill discovery 
            that captures the <b>periodic nature</b> of behaviors by embedding states into a 
            <b>circular latent space</b>. By optimizing a constrained objective that encodes 
            temporal distance, PSD enables agents to learn periodic behaviors with 
            <b>controllable periods</b> across multiple timescales.
          </p>

          <!-- 1. Circular Latent Representation -->
          <h4 class="title is-4" style="margin-top: 1.5em;">1. Circular Latent Representation</h4>
          <p>
            PSD trains an encoder \( \phi_L(s) \) that maps each state \( s \) to a point 
            on a circle of diameter \( L \), where \( L \) denotes the skill’s period variable.
            The objective encourages states \( s_t \) and \( s_{t+L} \) to lie at opposite 
            points on the circle while maintaining uniform angular spacing between 
            consecutive states:
          </p>

          <p style="margin: 0.8em 0;">
            \[
              \mathcal{J}_{\text{PSD}}
              = \mathbb{E}\!\left[
                \|\phi_L(s_{t+L}) - \phi_L(s_t)\|^2
                - k \|\phi_L(s_{t+L}) + \phi_L(s_t)\|^2
              \right]
            \]
            \[
              \text{s.t. } 
              \|\phi_L(s_{t+L}) - \phi_L(s_t)\| \le L,\quad
              \|\phi_L(s_{t+1}) - \phi_L(s_t)\| \le L \sin\!\left(\tfrac{\pi}{2L}\right).
            \]
          </p>

          <p>
            These constraints ensure that the latent representation forms a regular 
            \( 2L \)-gon on the circle, making each skill’s trajectory periodic with a 
            full rotation every \( 2L \) steps.
          </p>

          <!-- 2. Single-Step Intrinsic Reward -->
          <h4 class="title is-4" style="margin-top: 1.5em;">2. Single-step Intrinsic Reward</h4>
          <p>
            The agent is jointly trained with a single-step intrinsic reward that encourages
            consistent motion along the circular latent path. The deviation from the 
            ideal step length \( L \sin(\pi/2L) \) defines the reward:
          </p>

          <p style="margin: 0.8em 0;">
            \[
              r_{\text{PSD}}(s_t, s_{t+1}, L)
              = \exp\!\Big(-\kappa \big(
                \|\phi_L(s_{t+1}) - \phi_L(s_t)\|
                - L \sin\!\tfrac{\pi}{2L}
              \big)^2\Big),
            \]
          </p>

          <p>
            Maximizing \( r_{\text{PSD}} \) makes the policy follow a smooth circular 
            trajectory in latent space, yielding behaviors that naturally repeat every 
            \( 2L \) steps.
          </p>

          <!-- 3. Adaptive Sampling -->
          <h4 class="title is-4" style="margin-top: 1.5em;">3. Adaptive Sampling Method</h4>
          <p>
            To autonomously explore diverse periods, PSD adaptively adjusts the sampling 
            range \( [L_{\min}, L_{\max}] \) based on the agent’s performance. When the 
            policy successfully maintains periodicity for the current bounds, the range is 
            expanded, allowing discovery of longer or shorter cycles over training.
          </p>

          <!-- takeaway -->
          <div style="
            margin-top: 2em;
            padding: 1em 1.2em;
            background: rgba(240,240,240,0.8);
            border-radius: 10px;
            text-align: center;
            font-style: italic;
            color: #444;
          ">
            By mapping states to a circular latent space and optimizing for temporal 
            distance, PSD learns <b>multi-timescale periodic skills</b> that are 
            geometrically interpretable and effective even from pixel-based inputs.
          </div>

        </div>
      </div>
    </div>
  </div>
</section>

<!-- MathJax for equations -->
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>



<!-- METHOD -->
<section class="section" id="Periodic Skill Discovery">
  <div class="container" style="max-width: 1100px; margin: 0 auto;">
    <div class="columns is-centered">
      <div class="column is-full-width">
        <h2 class="title is-3" style="text-align: left;">Can PSD discover diverse periodic skills across multiple timescales?</h2>
        <div class="content" style="text-align: left;">
        Add figure 3
        Add Adaptive sampling 
        </div>
      </div>
    </div>
  </div>
</section>

<!-- RESULTS / CAROUSEL + INTERPOLATION -->
<section class="section" id="results">
  <div class="container" style="max-width: 1100px; margin: 0 auto;">

    <!-- RESULTS -->
    <div class="columns is-centered">
      <div class="column is-full-width has-text-centered">
        <h2 class="title is-3" style="text-align: left;">Results</h2>

        <!-- 1. STATE-BASED -->
        <h4 class="title is-4" style="margin-top: 1.5em; text-align: left;">1. State-based Environment</h4>
        <div class="has-text-centered" style="margin-top:1rem;">
          <video id="video-state" preload="auto" muted playsinline autoplay loop 
                style="max-width:100%; height:auto;"></video>
        </div>
        <div class="video-switcher" id="switcher-state" role="group" aria-label="State environment selector"
            style="margin-top: 1rem;">
          <button class="btn-pill is-active" data-src="./static/videos/psd_teaser.mp4">Ant</button>
          <button class="btn-pill" data-src="./static/videos/psd_teaser.mp4">HalfCheetah</button>
          <button class="btn-pill" data-src="./static/videos/psd_teaser.mp4">Humanoid</button>
          <button class="btn-pill" data-src="./static/videos/psd_teaser.mp4">Hopper</button>
          <button class="btn-pill" data-src="./static/videos/psd_teaser.mp4">Walker2D</button>
        </div>

        <!-- 2. PIXEL-BASED -->
        <h4 class="title is-4" style="margin-top: 1.5em; text-align: left;">2. Pixel-based Environment</h4>
        <div class="has-text-centered" style="margin-top:1rem;">
          <video id="video-pixel" preload="auto" muted playsinline autoplay loop 
                style="max-width:100%; height:auto;"></video>
        </div>
        <div class="video-switcher" id="switcher-pixel" role="group" aria-label="Pixel environment selector"
            style="margin-top: 1rem;">
          <button class="btn-pill is-active" data-src="./static/videos/psd_teaser.mp4">Ant</button>
          <button class="btn-pill" data-src="./static/videos/psd_teaser.mp4">HalfCheetah</button>
        </div>

        <!-- 3. METRA COMBINATION -->
        <h4 class="title is-4" style="margin-top: 1.5em; text-align: left;">3. Combination with METRA</h4>
        <div class="has-text-centered" style="margin-top:1rem;">
          <video id="video-metra" preload="auto" muted playsinline autoplay loop 
                style="max-width:100%; height:auto;"></video>
        </div>
        <div class="video-switcher" id="switcher-metra" role="group" aria-label="METRA environment selector"
            style="margin-top: 1rem;">
          <button class="btn-pill is-active" data-src="./static/videos/psd_teaser.mp4">Ant</button>
          <button class="btn-pill" data-src="./static/videos/psd_teaser.mp4">Walker2D</button>
        </div>
      </div>
    </div>
  </div>
</section>


<!-- BIBTEX -->
<section class="section" id="bibtex">
  <div class="container" style="max-width: 1100px; margin: 0 auto;">
    <h2 class="title">BibTeX</h2>
    <pre><code>@inproceedings{park2025psd,
  author    = {Park, Jonghae and Cho, Daesol and Lee, Jusuk and Shim, Dongseok and Jang, Inkyu and Kim, H. Jin},
  title     = {Periodic Skill Discovery},
  booktitle = {NeurIPS},
  year      = {2025}
}</code></pre>
  </div>
</section>

<!-- FOOTER (license note kept minimal) -->
<footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <a class="icon-link"
         href="./static/videos/nerfies_paper.pdf">
        <i class="fas fa-file-pdf"></i>
      </a>
      <a class="icon-link" href="https://github.com/keunhong" class="external-link" disabled>
        <i class="fab fa-github"></i>
      </a>
    </div>
    <div class="columns is-centered">
      <div class="column is-8">
        <div class="content">
          <p>
            This website is licensed under a <a rel="license"
                                                href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
            Commons Attribution-ShareAlike 4.0 International License</a>.
          </p>
          <p>
            This means you are free to borrow the <a
              href="https://github.com/nerfies/nerfies.github.io">source code</a> of this website,
            we just ask that you link back to this page in the footer.
            Please remember to remove the analytics code included in the header of the website which
            you do not want on your website.
          </p>
        </div>
      </div>
    </div>
  </div>
</footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // ① 여러 쌍 자동 처리: id가 'video-*' 형태인 모든 비디오 탐색
  const multiVideos = Array.from(document.querySelectorAll('video[id^="video-"]'));
  const groups = [];

  multiVideos.forEach(vid => {
    const suffix = vid.id.replace(/^video-/, '');              // ex) 'state'
    const switcher = document.getElementById(`switcher-${suffix}`);
    if (switcher) groups.push({ videoEl: vid, switcherEl: switcher });
  });

  // ② 레거시(단일 쌍) 지원: 기존 코드 그대로도 동작하도록 백업 경로
  const legacyVideo = document.getElementById('result-video');
  const legacySwitcher = document.querySelector('#video-switcher');
  if (!groups.length && legacyVideo && legacySwitcher) {
    groups.push({ videoEl: legacyVideo, switcherEl: legacySwitcher });
  }

  // 그룹 초기화 함수
  function initGroup(video, switcher) {
    const buttons = Array.from(switcher.querySelectorAll('.btn-pill'));
    if (!buttons.length) return;

    // iOS/모바일 자동재생 호환
    video.muted = true;
    video.setAttribute('muted', '');
    video.setAttribute('playsinline', '');
    video.setAttribute('autoplay', '');
    video.setAttribute('loop', '');
    video.setAttribute('preload', 'auto'); // 초기 버퍼 충분히

    function setActive(btn) {
      buttons.forEach(b => {
        b.classList.remove('is-active');
        b.setAttribute('aria-pressed', 'false');
      });
      btn.classList.add('is-active');
      btn.setAttribute('aria-pressed', 'true');
    }

    // 기존 switchVideo 함수를 아래로 교체
    function switchVideo(src) {
      if (!src) return;

      // 이벤트 중복 방지
      video.oncanplaythrough = null;
      video.onloadeddata = null;

      const abs = new URL(src, window.location.href).href;

      // 소스 교체
      if (video.src !== abs) {
        video.pause();
        video.src = src;
        video.load();
      } else {
        // 같은 소스면 처음부터 재생
        try { video.currentTime = 0; } catch(e) {}
      }

      // 충분히 로드된 뒤에 재생 (끊김 방지)
      const resume = () => {
        try {
          // iOS 사파리 첫 프레임 멈춤 버그 회피
          if (video.currentTime === 0) video.currentTime = 0.001;
        } catch (e) {}
        const p = video.play();
        if (p && typeof p.catch === 'function') p.catch(()=>{});
      };

      let fired = false;
      video.oncanplaythrough = () => { if (!fired) { fired = true; resume(); } };
      video.onloadeddata     = () => { if (!fired) { fired = true; resume(); } };
    }

    // 초기 버튼(있으면 is-active, 없으면 첫 번째)로 세팅
    const initial = buttons.find(b => b.classList.contains('is-active')) || buttons[0];
    if (initial) {
      setActive(initial);
      switchVideo(initial.getAttribute('data-src'));
    }

    // 클릭 핸들러
    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        setActive(btn);
        switchVideo(btn.getAttribute('data-src'));
      });
    });
  }

  // 모든 그룹 적용
  groups.forEach(({ videoEl, switcherEl }) => initGroup(videoEl, switcherEl));
});
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // ✅ 여기에 에피소드 이미지 경로를 순서대로 넣어주세요 (에피소드 진행 순)
  //    10장 내외 권장, 2장만 넣어도 중간값들을 블렌딩해서 보여줍니다.
  const IMAGE_URLS = [
    './static/images/episode_000.jpg',
    './static/images/episode_050.jpg',
    './static/images/episode_100.jpg',
    './static/images/episode_150.jpg',
    './static/images/episode_200.jpg',
    './static/images/episode_250.jpg',
    './static/images/episode_300.jpg',
    './static/images/episode_350.jpg',
    './static/images/episode_400.jpg',
    './static/images/episode_450.jpg'
  ];

  const wrapper = document.getElementById('interpolation-image-wrapper');
  const slider  = document.getElementById('interpolation-slider');
  if (!wrapper || !slider || !IMAGE_URLS.length) return;

  // 캔버스 생성
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d', { alpha: true });
  wrapper.innerHTML = ''; // "Loading..." 제거
  wrapper.appendChild(canvas);

  // 이미지 사전 로드
  const imgs = [];
  let loaded = 0;

  function preload() {
    return Promise.all(IMAGE_URLS.map(src => new Promise((resolve, reject) => {
      const im = new Image();
      im.onload = () => { imgs.push(im); resolve(); };
      im.onerror = reject;
      im.src = src;
    })));
  }

  function resizeTo(img) {
    // 기준: 첫 이미지 크기
    canvas.width  = img.width;
    canvas.height = img.height;
  }

  // t in [0, K-1]에서 두 프레임 선형보간 (floor/ceil)
  function drawInterpolated(t) {
    const K = imgs.length;
    if (K === 0) return;
    if (K === 1) { // 한 장만 있으면 그대로 그림
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.globalAlpha = 1.0;
      ctx.drawImage(imgs[0], 0, 0, canvas.width, canvas.height);
      return;
    }

    // t를 [0, K-1] 범위로
    t = Math.max(0, Math.min(K - 1, t));
    const i = Math.floor(t);
    const j = Math.min(K - 1, i + 1);
    const a = t - i; // 0~1

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    // 아래 프레임
    ctx.globalAlpha = 1.0;
    ctx.drawImage(imgs[i], 0, 0, canvas.width, canvas.height);
    // 위 프레임(알파 a로 블렌딩)
    ctx.globalAlpha = a;
    ctx.drawImage(imgs[j], 0, 0, canvas.width, canvas.height);
    ctx.globalAlpha = 1.0;
  }

  // 슬라이더 값(0~9)을 전체 구간 [0, K-1]로 매핑
  function sliderToT(value) {
    const K = imgs.length;
    if (K <= 1) return 0;
    const steps = 9; // 0..9 총 10단계
    const u = Number(value) / steps;   // 0..1
    return u * (K - 1);                // 0..K-1
  }

  // 초기화
  preload().then(() => {
    // 기준 크기 세팅 (첫 장)
    resizeTo(imgs[0]);

    // 초기 그리기
    drawInterpolated(sliderToT(slider.value));

    // 리스너
    let rafId = null;
    slider.addEventListener('input', () => {
      if (rafId) cancelAnimationFrame(rafId);
      rafId = requestAnimationFrame(() => {
        drawInterpolated(sliderToT(slider.value));
        rafId = null;
      });
    });

    // 반응형(옵션): 창 크기 바뀌어도 픽셀 비율 유지하고 싶으면 여기에 로직 추가 가능
  }).catch(err => {
    wrapper.textContent = 'Failed to load images.';
    console.error(err);
  });
});
</script>

<!-- MathJax for equations (keep once per page) -->
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>


</body>
</html>
